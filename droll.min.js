(function(){var root=this;var droll={};function DrollFormula(){this.numDice=0;this.numSides=0;this.modifier=0}function DrollResult(){this.rolls=[];this.modifier=0;this.total=0}DrollResult.prototype.toString=function(){if(this.rolls.length===1&&this.modifier===0){return this.rolls[0]+""}if(this.rolls.length>1&&this.modifier===0){return this.rolls.join(" + ")+" = "+this.total}if(this.rolls.length===1&&this.modifier>0){return this.rolls[0]+" + "+this.modifier+" = "+this.total}if(this.rolls.length>1&&this.modifier>0){return this.rolls.join(" + ")+" + "+this.modifier+" = "+this.total}if(this.rolls.length===1&&this.modifier<0){return this.rolls[0]+" - "+Math.abs(this.modifier)+" = "+this.total}if(this.rolls.length>1&&this.modifier<0){return this.rolls.join(" + ")+" - "+Math.abs(this.modifier)+" = "+this.total}};droll.parse=function(formula){var pieces=null;var result=new DrollFormula;pieces=formula.match(/^([1-9]\d*)?d([1-9]\d*)([+-]\d+)?$/i);if(!pieces){return false}result.numDice=pieces[1]-0||1;result.numSides=pieces[2]-0;result.modifier=pieces[3]-0||0;return result};droll.validate=function(formula){return droll.parse(formula)?true:false};droll.roll=function(formula){var pieces=null;var result=new DrollResult;pieces=droll.parse(formula);if(!pieces){return false}for(var a=0;a<pieces.numDice;a++){result.rolls[a]=1+Math.floor(Math.random()*pieces.numSides)}result.modifier=pieces.modifier;for(var b=0;b<result.rolls.length;b++){result.total+=result.rolls[b]}result.total+=result.modifier;return result};if(typeof module!=="undefined"&&module.exports){module.exports=droll}else{root.droll=droll}})();